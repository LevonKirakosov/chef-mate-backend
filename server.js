/*
 * Ğ¤Ğ°Ğ¹Ğ»: server.js
 * ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ: Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ, Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ v3.
 * Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ Ğ½Ğ° ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ° Ğ¸ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸.
 */

// --- 1. ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ñ… Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº ---
const express = require("express");
const bodyParser = require("body-parser");
const TelegramBot = require("node-telegram-bot-api");
const cron = require("node-cron");

// --- 2. Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ---
const app = express();
app.use(bodyParser.json());

const token = process.env.TELEGRAM_TOKEN;
if (!token) {
  console.error("ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ ĞĞ¨Ğ˜Ğ‘ĞšĞ: TELEGRAM_TOKEN Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½!");
  process.exit(1);
}

const bot = new TelegramBot(token, { polling: false });

const webhookPath = `/telegram/webhook/${token}`;

// --- 3. ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ‘Ğ°Ğ·Ğ° Ğ”Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ñ ÑĞ°Ğ¹Ñ‚Ğ°) ---
const menuData = {
    monday: { name: "Ğ˜Ñ‚Ğ°Ğ»Ğ¸Ñ ğŸ‡®ğŸ‡¹", dishes: [
        { id: 'ita-sal', type: 'Ğ¡Ğ°Ğ»Ğ°Ñ‚', name: 'ĞŸĞ°Ğ½Ñ†Ğ°Ğ½ĞµĞ»Ğ»Ğ°', desc: '(Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ñ‹, Ğ¾Ğ³ÑƒÑ€Ñ†Ñ‹, Ñ…Ğ»ĞµĞ±, Ğ±Ğ°Ğ·Ğ¸Ğ»Ğ¸Ğº)', cooking_process: '1. ĞĞ°Ñ€ĞµĞ·Ğ°Ñ‚ÑŒ ĞºÑ€ÑƒĞ¿Ğ½Ğ¾ Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€Ñ‹, Ğ¾Ğ³ÑƒÑ€Ñ†Ñ‹, Ğ»ÑƒĞº. 2. ĞŸĞ¾Ğ´ÑÑƒÑˆĞ¸Ñ‚ÑŒ Ñ…Ğ»ĞµĞ±. 3. Ğ¡Ğ¼ĞµÑˆĞ°Ñ‚ÑŒ Ğ¾Ğ²Ğ¾Ñ‰Ğ¸, Ñ…Ğ»ĞµĞ±, Ğ±Ğ°Ğ·Ğ¸Ğ»Ğ¸Ğº Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ»Ğ¸Ğ²ĞºĞ¾Ğ²Ñ‹Ğ¼ Ğ¼Ğ°ÑĞ»Ğ¾Ğ¼ Ğ¸ Ğ²Ğ¸Ğ½Ğ½Ñ‹Ğ¼ ÑƒĞºÑÑƒÑĞ¾Ğ¼. Ğ”Ğ°Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‚ÑŒÑÑ 5-10 Ğ¼Ğ¸Ğ½ÑƒÑ‚.' },
        { id: 'ita-soup', type: 'Ğ¡ÑƒĞ¿', name: 'ĞœĞ¸Ğ½ĞµÑÑ‚Ñ€Ğ¾Ğ½Ğµ', desc: '(ÑĞµĞ·Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ¾Ğ²Ğ¾Ñ‰Ğ¸, Ğ¿Ğ°ÑÑ‚Ğ°)', cooking_process: '1. ĞĞ°Ñ€ĞµĞ·Ğ°Ñ‚ÑŒ Ğ¼ĞµĞ»ĞºĞ¾ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ, Ğ¼Ğ¾Ñ€ĞºĞ¾Ğ²ÑŒ, Ğ»ÑƒĞº, ÑĞµĞ»ÑŒĞ´ĞµÑ€ĞµĞ¹, ĞºĞ°Ğ±Ğ°Ñ‡Ğ¾Ğº. 2. ĞŸĞ°ÑÑĞµÑ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ²Ğ¾Ñ‰Ğ¸, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ñ‹ Ğ¸ Ğ±ÑƒĞ»ÑŒĞ¾Ğ½. Ğ’Ğ°Ñ€Ğ¸Ñ‚ÑŒ 15-20 Ğ¼Ğ¸Ğ½ÑƒÑ‚. 3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ°ÑÑ‚Ñƒ Ğ¸ Ğ·ĞµĞ»ĞµĞ½Ñ‹Ğ¹ Ğ³Ğ¾Ñ€Ğ¾ÑˆĞµĞº, Ğ²Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸.' },
        { id: 'ita-hot', type: 'Ğ“Ğ¾Ñ€ÑÑ‡ĞµĞµ', name: 'Ğ›Ğ°Ğ·Ğ°Ğ½ÑŒÑ Ğ‘Ğ¾Ğ»Ğ¾Ğ½ÑŒĞµĞ·Ğµ', desc: '(ÑĞ¾ÑƒÑ Ğ‘Ğ¾Ğ»Ğ¾Ğ½ÑŒĞµĞ·Ğµ, ÑĞ¾ÑƒÑ Ğ‘ĞµÑˆĞ°Ğ¼ĞµĞ»ÑŒ, ÑÑ‹Ñ€)', cooking_process: '1. ĞŸÑ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾ÑƒÑÑ‹ "Ğ‘Ğ¾Ğ»Ğ¾Ğ½ÑŒĞµĞ·Ğµ" Ğ¸ "Ğ‘ĞµÑˆĞ°Ğ¼ĞµĞ»ÑŒ". 2. Ğ’ Ñ„Ğ¾Ñ€Ğ¼Ğµ Ğ²Ñ‹Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ ÑĞ»Ğ¾ÑĞ¼Ğ¸: ÑĞ¾ÑƒÑ Ğ‘Ğ¾Ğ»Ğ¾Ğ½ÑŒĞµĞ·Ğµ, Ğ»Ğ¸ÑÑ‚ Ğ»Ğ°Ğ·Ğ°Ğ½ÑŒĞ¸, ÑĞ¾ÑƒÑ Ğ‘ĞµÑˆĞ°Ğ¼ĞµĞ»ÑŒ, ÑÑ‹Ñ€. ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ. 3. Ğ—Ğ°Ğ¿ĞµĞºĞ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸ 180Â°C 20-25 Ğ¼Ğ¸Ğ½ÑƒÑ‚.' }
    ]},
    tuesday: { name: "Ğ“Ñ€ÑƒĞ·Ğ¸Ñ ğŸ‡¬ğŸ‡ª", dishes: [
        { id: 'geo-sal', type: 'Ğ¡Ğ°Ğ»Ğ°Ñ‚', name: 'Ğ“Ñ€ÑƒĞ·Ğ¸Ğ½ÑĞºĞ¸Ğ¹ Ñ Ğ¾Ñ€ĞµÑ…Ğ¾Ğ²Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹', desc: '(Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ñ‹, Ğ¾Ğ³ÑƒÑ€Ñ†Ñ‹, Ğ¾Ñ€ĞµÑ…Ğ¸, ĞºĞ¸Ğ½Ğ·Ğ°)', cooking_process: '1. ĞšÑ€ÑƒĞ¿Ğ½Ğ¾ Ğ½Ğ°Ñ€ĞµĞ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€Ñ‹ Ğ¸ Ğ¾Ğ³ÑƒÑ€Ñ†Ñ‹. 2. ĞŸÑ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ: Ğ¸Ğ·Ğ¼ĞµĞ»ÑŒÑ‡Ğ¸Ñ‚ÑŒ Ğ³Ñ€ĞµÑ†ĞºĞ¸Ğµ Ğ¾Ñ€ĞµÑ…Ğ¸ Ğ¸ Ñ‡ĞµÑĞ½Ğ¾Ğº Ğ² Ğ¿Ğ°ÑÑ‚Ñƒ, ÑĞ¼ĞµÑˆĞ°Ñ‚ÑŒ Ñ ÑƒĞºÑÑƒÑĞ¾Ğ¼, Ğ²Ğ¾Ğ´Ğ¾Ğ¹ Ğ¸ ÑĞ¿ĞµÑ†Ğ¸ÑĞ¼Ğ¸. 3. Ğ¡Ğ¾ĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ Ğ¾Ğ²Ğ¾Ñ‰Ğ¸ Ñ Ğ·Ğ°Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹.' },
        { id: 'geo-soup', type: 'Ğ¡ÑƒĞ¿', name: 'Ğ¥Ğ°Ñ€Ñ‡Ğ¾', desc: '(Ğ³Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ°, Ñ€Ğ¸Ñ, Ñ‚ĞºĞµĞ¼Ğ°Ğ»Ğ¸, Ğ¾Ñ€ĞµÑ…Ğ¸)', cooking_process: '1. Ğ¡Ğ²Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ³Ğ¾Ğ²ÑĞ¶Ğ¸Ğ¹ Ğ±ÑƒĞ»ÑŒĞ¾Ğ½. 2. ĞŸĞ°ÑÑĞµÑ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ»ÑƒĞº Ñ Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ½Ğ¾Ğ¹ Ğ¿Ğ°ÑÑ‚Ğ¾Ğ¹. 3. Ğ’ Ğ±ÑƒĞ»ÑŒĞ¾Ğ½ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€Ğ¸Ñ, Ñ‚ĞºĞµĞ¼Ğ°Ğ»Ğ¸, Ğ¾Ñ€ĞµÑ…Ğ¸ Ğ¸ Ğ¿Ğ°ÑÑĞµÑ€Ğ¾Ğ²ĞºÑƒ. Ğ’Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ€Ğ¸ÑĞ°. Ğ’ ĞºĞ¾Ğ½Ñ†Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑĞ½Ğ¾Ğº Ğ¸ ĞºĞ¸Ğ½Ğ·Ñƒ.' },
        { id: 'geo-hot', type: 'Ğ“Ğ¾Ñ€ÑÑ‡ĞµĞµ', name: 'Ğ§Ğ°Ñ…Ğ¾Ñ…Ğ±Ğ¸Ğ»Ğ¸ Ğ¸Ğ· ĞºÑƒÑ€Ğ¸Ñ†Ñ‹', desc: '(ĞºÑƒÑ€Ğ¸Ğ½Ğ¾Ğµ Ğ±ĞµĞ´Ñ€Ğ¾, Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ñ‹, ÑĞ¿ĞµÑ†Ğ¸Ğ¸)', cooking_process: '1. ĞĞ±Ğ¶Ğ°Ñ€Ğ¸Ñ‚ÑŒ ĞºÑƒÑĞºĞ¸ ĞºÑƒÑ€Ğ¸Ñ†Ñ‹ Ğ´Ğ¾ Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ¸ÑÑ‚Ğ¾Ğ¹ ĞºĞ¾Ñ€Ğ¾Ñ‡ĞºĞ¸. 2. ĞĞ° Ğ²Ñ‹Ñ‚Ğ¾Ğ¿Ğ¸Ğ²ÑˆĞµĞ¼ÑÑ Ğ¶Ğ¸Ñ€Ğµ Ğ¾Ğ±Ğ¶Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ»ÑƒĞº, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€Ñ‹. 3. Ğ¡Ğ¾ĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ ĞºÑƒÑ€Ğ¸Ñ†Ñƒ Ñ Ğ¾Ğ²Ğ¾Ñ‰Ğ°Ğ¼Ğ¸, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¿ĞµÑ†Ğ¸Ğ¸ Ğ¸ Ñ‚ÑƒÑˆĞ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ ĞºÑ€Ñ‹ÑˆĞºĞ¾Ğ¹ 30-40 Ğ¼Ğ¸Ğ½ÑƒÑ‚.' }
    ]},
    wednesday: { name: "Ğ¤Ñ€Ğ°Ğ½Ñ†Ğ¸Ñ ğŸ‡«ğŸ‡·", dishes: [
        { id: 'fra-sal', type: 'Ğ¡Ğ°Ğ»Ğ°Ñ‚', name: 'Ğ›Ğ¸Ğ¾Ğ½ÑĞºĞ¸Ğ¹ ÑĞ°Ğ»Ğ°Ñ‚', desc: '(ÑĞ°Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ğ¼Ğ¸ĞºÑ, Ğ±ĞµĞºĞ¾Ğ½, ÑĞ¹Ñ†Ğ¾-Ğ¿Ğ°ÑˆĞ¾Ñ‚)', cooking_process: '1. ĞĞ±Ğ¶Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ±ĞµĞºĞ¾Ğ½, Ğ¿Ñ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ³Ñ€ĞµĞ½ĞºĞ¸. 2. ĞŸÑ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¹Ñ†Ğ¾-Ğ¿Ğ°ÑˆĞ¾Ñ‚. 3. Ğ’Ñ‹Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ½Ğ° ÑĞ°Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ»Ğ¸ÑÑ‚ÑŒÑ Ğ³Ñ€ĞµĞ½ĞºĞ¸ Ğ¸ Ğ±ĞµĞºĞ¾Ğ½, Ğ² Ñ†ĞµĞ½Ñ‚Ñ€ Ğ¿Ğ¾Ğ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ ÑĞ¹Ñ†Ğ¾-Ğ¿Ğ°ÑˆĞ¾Ñ‚. ĞŸĞ¾Ğ»Ğ¸Ñ‚ÑŒ Ğ´Ğ¸Ğ¶Ğ¾Ğ½ÑĞºĞ¾Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹.' },
        { id: 'fra-soup', type: 'Ğ¡ÑƒĞ¿', name: 'Ğ“Ñ€Ğ¸Ğ±Ğ½Ğ¾Ğ¹ ĞºÑ€ĞµĞ¼-ÑÑƒĞ¿', desc: '(ÑˆĞ°Ğ¼Ğ¿Ğ¸Ğ½ÑŒĞ¾Ğ½Ñ‹, ÑĞ»Ğ¸Ğ²ĞºĞ¸, Ñ‚Ñ€ÑÑ„ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¼Ğ°ÑĞ»Ğ¾)', cooking_process: '1. ĞĞ±Ğ¶Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ³Ñ€Ğ¸Ğ±Ñ‹ Ñ Ğ»ÑƒĞºĞ¾Ğ¼. 2. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ, Ğ±ÑƒĞ»ÑŒĞ¾Ğ½ Ğ¸ Ğ²Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸. ĞŸÑÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ»ĞµĞ½Ğ´ĞµÑ€Ğ¾Ğ¼. 3. Ğ’Ğ»Ğ¸Ñ‚ÑŒ ÑĞ»Ğ¸Ğ²ĞºĞ¸, Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑ‚ÑŒ, Ğ½Ğµ Ğ´Ğ¾Ğ²Ğ¾Ğ´Ñ Ğ´Ğ¾ ĞºĞ¸Ğ¿ĞµĞ½Ğ¸Ñ.' },
        { id: 'fra-hot', type: 'Ğ“Ğ¾Ñ€ÑÑ‡ĞµĞµ', name: 'ĞšÑƒÑ€Ğ¸Ğ½Ğ¾Ğµ Ñ„Ñ€Ğ¸ĞºĞ°ÑĞµ', desc: '(ĞºÑƒÑ€Ğ¸Ğ½Ğ¾Ğµ Ñ„Ğ¸Ğ»Ğµ, Ğ³Ñ€Ğ¸Ğ±Ñ‹, ÑĞ»Ğ¸Ğ²Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ ÑĞ¾ÑƒÑ)', cooking_process: '1. ĞĞ±Ğ¶Ğ°Ñ€Ğ¸Ñ‚ÑŒ ĞºÑƒÑĞ¾Ñ‡ĞºĞ¸ ĞºÑƒÑ€Ğ¸Ñ†Ñ‹ Ñ Ğ»ÑƒĞºĞ¾Ğ¼ Ğ¸ Ğ³Ñ€Ğ¸Ğ±Ğ°Ğ¼Ğ¸. 2. ĞŸÑ€Ğ¸ÑÑ‹Ğ¿Ğ°Ñ‚ÑŒ Ğ¼ÑƒĞºĞ¾Ğ¹, Ğ²Ğ»Ğ¸Ñ‚ÑŒ Ğ²Ğ¸Ğ½Ğ¾ (Ğ¿Ğ¾ Ğ¶ĞµĞ»Ğ°Ğ½Ğ¸Ñ) Ğ¸ ÑĞ»Ğ¸Ğ²ĞºĞ¸. 3. Ğ¢ÑƒÑˆĞ¸Ñ‚ÑŒ 10-15 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ´Ğ¾ Ğ·Ğ°Ğ³ÑƒÑÑ‚ĞµĞ½Ğ¸Ñ ÑĞ¾ÑƒÑĞ°.' }
    ]},
    thursday: { name: "Ğ Ğ¾ÑÑĞ¸Ñ ğŸ‡·ğŸ‡º", dishes: [
        { id: 'rus-sal', type: 'Ğ¡Ğ°Ğ»Ğ°Ñ‚', name: 'Ğ’Ğ¸Ğ½ĞµĞ³Ñ€ĞµÑ‚ Ñ ĞºĞ¸Ğ»ÑŒĞºĞ¾Ğ¹', desc: '(ÑĞ²ĞµĞºĞ»Ğ°, ĞºĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ, ĞºĞ¸Ğ»ÑŒĞºĞ°, Ğ³Ñ€ĞµĞ½ĞºĞ¸)', cooking_process: '1. ĞÑ‚Ğ²Ğ°Ñ€Ğ½Ñ‹Ğµ Ğ¾Ğ²Ğ¾Ñ‰Ğ¸ Ğ½Ğ°Ñ€ĞµĞ·Ğ°Ñ‚ÑŒ ĞºÑƒĞ±Ğ¸ĞºĞ¾Ğ¼, ÑĞ¼ĞµÑˆĞ°Ñ‚ÑŒ Ñ ĞºĞ²Ğ°ÑˆĞµĞ½Ğ¾Ğ¹ ĞºĞ°Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ğ¸ Ğ³Ğ¾Ñ€Ğ¾ÑˆĞºĞ¾Ğ¼. 2. Ğ—Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ°Ñ€Ğ¾Ğ¼Ğ°Ñ‚Ğ½Ñ‹Ğ¼ Ğ¿Ğ¾Ğ´ÑĞ¾Ğ»Ğ½ĞµÑ‡Ğ½Ñ‹Ğ¼ Ğ¼Ğ°ÑĞ»Ğ¾Ğ¼. 3. ĞŸĞ¾Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ñ Ñ„Ğ¸Ğ»Ğµ ĞºĞ¸Ğ»ÑŒĞºĞ¸ Ğ¸ Ğ±Ğ¾Ñ€Ğ¾Ğ´Ğ¸Ğ½ÑĞºĞ¸Ğ¼Ğ¸ Ğ³Ñ€ĞµĞ½ĞºĞ°Ğ¼Ğ¸.' },
        { id: 'rus-soup', type: 'Ğ¡ÑƒĞ¿', name: 'Ğ‘Ğ¾Ñ€Ñ‰ Â«ĞœĞ¾ÑĞºĞ¾Ğ²ÑĞºĞ¸Ğ¹Â»', desc: '(Ğ³Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ°, ÑĞ²ĞµĞºĞ»Ğ°, ĞºĞ¾Ğ¿Ñ‡ĞµĞ½Ğ¾ÑÑ‚Ğ¸)', cooking_process: '1. Ğ¡Ğ²Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ±ÑƒĞ»ÑŒĞ¾Ğ½. Ğ¢ÑƒÑˆĞ¸Ñ‚ÑŒ ÑĞ²ĞµĞºĞ»Ñƒ Ñ Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ½Ğ¾Ğ¹ Ğ¿Ğ°ÑÑ‚Ğ¾Ğ¹. 2. Ğ’ Ğ±ÑƒĞ»ÑŒĞ¾Ğ½ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ Ğ¸ ĞºĞ°Ğ¿ÑƒÑÑ‚Ñƒ, Ğ·Ğ°Ñ‚ĞµĞ¼ Ğ¿Ğ°ÑÑĞµÑ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾Ğ²Ğ¾Ñ‰Ğ¸ Ğ¸ ÑĞ²ĞµĞºĞ»Ñƒ. Ğ’Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸. 3. ĞŸĞ¾Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ñ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ¼ Ğ½Ğ°Ñ€ĞµĞ·Ğ°Ğ½Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¿Ñ‡ĞµĞ½Ğ¾ÑÑ‚ĞµĞ¹ Ğ¸ ÑĞ¼ĞµÑ‚Ğ°Ğ½Ğ¾Ğ¹.' },
        { id: 'rus-hot', type: 'Ğ“Ğ¾Ñ€ÑÑ‡ĞµĞµ', name: 'Ğ‘ĞµÑ„ÑÑ‚Ñ€Ğ¾Ğ³Ğ°Ğ½Ğ¾Ğ² Ñ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ğ³Ñ€Ğ°Ñ‚ĞµĞ½Ğ¾Ğ¼', desc: '(Ğ³Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ°, ÑĞ¼ĞµÑ‚Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞ¾ÑƒÑ, Ğ³Ñ€Ğ°Ñ‚ĞµĞ½)', cooking_process: '1. Ğ¢Ğ¾Ğ½ĞºĞ¾ Ğ½Ğ°Ñ€ĞµĞ·Ğ°Ğ½Ğ½ÑƒÑ Ğ³Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ñƒ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ Ğ¾Ğ±Ğ¶Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ñ Ğ»ÑƒĞºĞ¾Ğ¼. 2. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¼ĞµÑ‚Ğ°Ğ½Ñƒ, Ğ¿Ñ€Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¸ Ñ‚ÑƒÑˆĞ¸Ñ‚ÑŒ 15-20 Ğ¼Ğ¸Ğ½ÑƒÑ‚. 3. ĞšĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ Ğ½Ğ°Ñ€ĞµĞ·Ğ°Ñ‚ÑŒ ÑĞ»Ğ°Ğ¹ÑĞ°Ğ¼Ğ¸, Ğ·Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ»Ğ¸Ğ²ĞºĞ°Ğ¼Ğ¸, Ğ¿Ğ¾ÑÑ‹Ğ¿Ğ°Ñ‚ÑŒ ÑÑ‹Ñ€Ğ¾Ğ¼ Ğ¸ Ğ·Ğ°Ğ¿ĞµĞºĞ°Ñ‚ÑŒ.' }
    ]},
    friday: { name: "ĞœĞµĞºÑĞ¸ĞºĞ° ğŸ‡²ğŸ‡½", dishes: [
        { id: 'mex-sal', type: 'Ğ¡Ğ°Ğ»Ğ°Ñ‚', name: 'ĞœĞµĞºÑĞ¸ĞºĞ°Ğ½ÑĞºĞ¸Ğ¹ ÑĞ°Ğ»Ğ°Ñ‚', desc: '(Ñ„Ğ°ÑĞ¾Ğ»ÑŒ, ĞºÑƒĞºÑƒÑ€ÑƒĞ·Ğ°, Ğ¿ĞµÑ€ĞµÑ†, Ğ»Ğ°Ğ¹Ğ¼)', cooking_process: '1. Ğ¡Ğ¼ĞµÑˆĞ°Ñ‚ÑŒ ĞºĞ¾Ğ½ÑĞµÑ€Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°ÑĞ¾Ğ»ÑŒ Ğ¸ ĞºÑƒĞºÑƒÑ€ÑƒĞ·Ñƒ. 2. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¼ĞµĞ»ĞºĞ¾ Ğ½Ğ°Ñ€ĞµĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ±Ğ¾Ğ»Ğ³Ğ°Ñ€ÑĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ĞµÑ†, Ğ¾Ğ³ÑƒÑ€ĞµÑ† Ğ¸ ĞºÑ€Ğ°ÑĞ½Ñ‹Ğ¹ Ğ»ÑƒĞº. 3. Ğ—Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¼ĞµÑÑŒÑ Ğ¾Ğ»Ğ¸Ğ²ĞºĞ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¼Ğ°ÑĞ»Ğ° Ğ¸ ÑĞ¾ĞºĞ° Ğ»Ğ°Ğ¹Ğ¼Ğ°.' },
        { id: 'mex-soup', type: 'Ğ¡ÑƒĞ¿', name: 'Ğ¢Ğ¾Ğ¼Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºÑ€ĞµĞ¼-ÑÑƒĞ¿ Ñ Ñ‡Ğ¸Ğ»Ğ¸', desc: '(Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ñ‹, Ñ‡Ğ¸Ğ»Ğ¸, ĞºĞ¸Ğ½Ğ·Ğ°)', cooking_process: '1. ĞŸĞ°ÑÑĞµÑ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ»ÑƒĞº Ğ¸ Ñ‡ĞµÑĞ½Ğ¾Ğº, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½ÑĞµÑ€Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ñ‹ Ğ¸ Ğ±ÑƒĞ»ÑŒĞ¾Ğ½. Ğ’Ğ°Ñ€Ğ¸Ñ‚ÑŒ 15-20 Ğ¼Ğ¸Ğ½ÑƒÑ‚. 2. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¸Ğ½Ğ·Ñƒ Ğ¸ Ğ¿ÑÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ»ĞµĞ½Ğ´ĞµÑ€Ğ¾Ğ¼. 3. ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑ‚ÑŒ, Ğ½Ğµ Ğ´Ğ¾Ğ²Ğ¾Ğ´Ñ Ğ´Ğ¾ ĞºĞ¸Ğ¿ĞµĞ½Ğ¸Ñ.' },
        { id: 'mex-hot', type: 'Ğ“Ğ¾Ñ€ÑÑ‡ĞµĞµ', name: 'ĞšĞµÑĞ°Ğ´Ğ¸Ğ»ÑŒÑ Ñ ĞºÑƒÑ€Ğ¸Ñ†ĞµĞ¹', desc: '(Ñ‚Ğ¾Ñ€Ñ‚Ğ¸Ğ»ÑŒÑ, ĞºÑƒÑ€Ğ¸Ñ†Ğ°, ÑÑ‹Ñ€, Ğ¾Ğ²Ğ¾Ñ‰Ğ¸)', cooking_process: '1. ĞĞ±Ğ¶Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ¼ĞµĞ»ĞºĞ¾ Ğ½Ğ°Ñ€ĞµĞ·Ğ°Ğ½Ğ½Ğ¾Ğµ ĞºÑƒÑ€Ğ¸Ğ½Ğ¾Ğµ Ñ„Ğ¸Ğ»Ğµ Ñ Ğ¿ĞµÑ€Ñ†ĞµĞ¼ Ğ¸ Ğ»ÑƒĞºĞ¾Ğ¼. 2. ĞĞ° Ğ¿Ğ¾Ğ»Ğ¾Ğ²Ğ¸Ğ½Ñƒ Ğ»ĞµĞ¿ĞµÑˆĞºĞ¸ Ğ²Ñ‹Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ñ‡Ğ¸Ğ½ĞºÑƒ, Ğ¿Ğ¾ÑÑ‹Ğ¿Ğ°Ñ‚ÑŒ ÑÑ‹Ñ€Ğ¾Ğ¼, ÑĞ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ°Ğ¼. 3. ĞĞ±Ğ¶Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ½Ğ° ÑÑƒÑ…Ğ¾Ğ¹ ÑĞºĞ¾Ğ²Ğ¾Ñ€Ğ¾Ğ´Ğµ Ğ´Ğ¾ Ñ€Ğ°ÑĞ¿Ğ»Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑÑ‹Ñ€Ğ°.' }
    ]}
};
const dayNames = { monday: 'ĞŸĞ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº', tuesday: 'Ğ’Ñ‚Ğ¾Ñ€Ğ½Ğ¸Ğº', wednesday: 'Ğ¡Ñ€ĞµĞ´Ğ°', thursday: 'Ğ§ĞµÑ‚Ğ²ĞµÑ€Ğ³', friday: 'ĞŸÑÑ‚Ğ½Ğ¸Ñ†Ğ°' };
const KITCHEN_CHAT_ID = '-1002389108118'; // ID Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ‡Ğ°Ñ‚Ğ°

// --- 4. Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¾Ñ‚ Telegram ---

app.post(webhookPath, (req, res) => {
  bot.processUpdate(req.body);
  res.sendStatus(200);
});

// ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ
bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  const userName = msg.from.first_name || 'ĞŸĞ¾Ğ²Ğ°Ñ€';
  const welcomeMessage = `Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ, ${userName}! Ğ¯ Ğ²Ğ°Ñˆ Ñ†Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ¾Ğ¹ ÑÑƒ-ÑˆĞµÑ„ "Chef-Mate".\n\nĞ¯ Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ÑŒ Ğ²Ğ°Ğ¼ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ ĞºÑƒÑ…Ğ½ĞµĞ¹. Ğ’Ğ¾Ñ‚ Ñ‡Ñ‚Ğ¾ Ñ ÑƒĞ¼ĞµÑ:\n- **/menu [Ğ´ĞµĞ½ÑŒ]**: ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¼ĞµĞ½Ñ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, /menu Ğ¿Ğ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº).\n- **/recipe [Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ]**: ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ€ĞµÑ†ĞµĞ¿Ñ‚ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, /recipe Ñ…Ğ°Ñ€Ñ‡Ğ¾).\n- **/fullmenu**: ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ.\n\nĞ˜Ğ»Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ² Ñ‡Ğ°Ñ‚ "ÑˆĞµÑ„, Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ", Ğ¸ Ñ Ğ¾Ñ‚ĞºĞ»Ğ¸ĞºĞ½ÑƒÑÑŒ!`;
  bot.sendMessage(chatId, welcomeMessage);
});

// ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /menu
bot.onText(/\/menu(?: (.+))?/, (msg, match) => {
    const chatId = msg.chat.id;
    const dayQuery = match[1] ? match[1].toLowerCase() : null;
    if (!dayQuery) {
        bot.sendMessage(chatId, "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑƒĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ´ĞµĞ½ÑŒ Ğ½ĞµĞ´ĞµĞ»Ğ¸ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, /menu Ğ¿Ğ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº).");
        return;
    }
    let dayKey = Object.keys(dayNames).find(key => dayNames[key].toLowerCase().startsWith(dayQuery));
    if (dayKey && menuData[dayKey]) {
        const dayMenu = menuData[dayKey];
        let response = `*${dayNames[dayKey]} â€” ${dayMenu.name}*\n\n`;
        dayMenu.dishes.forEach(dish => {
            response += `â€¢ *${dish.type}:* ${dish.name}\n`;
        });
        bot.sendMessage(chatId, response, { parse_mode: 'Markdown' });
    } else {
        bot.sendMessage(chatId, `ĞĞµ Ğ¼Ğ¾Ğ³Ñƒ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¼ĞµĞ½Ñ Ğ½Ğ° "${dayQuery}". ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ´ĞµĞ½ÑŒ Ğ½ĞµĞ´ĞµĞ»Ğ¸.`);
    }
});

// ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /recipe
bot.onText(/\/recipe (.+)/, (msg, match) => {
    const chatId = msg.chat.id;
    const query = match[1].toLowerCase();
    let foundDish = null;
    for (const day in menuData) {
        const dish = menuData[day].dishes.find(d => d.name.toLowerCase().includes(query));
        if (dish) { foundDish = dish; break; }
    }
    if (foundDish) {
        const response = `*ĞšÑ€Ğ°Ñ‚ĞºĞ°Ñ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ "${foundDish.name}":*\n\n${foundDish.cooking_process}`;
        bot.sendMessage(chatId, response, { parse_mode: 'Markdown' });
    } else {
        bot.sendMessage(chatId, `Ğ ĞµÑ†ĞµĞ¿Ñ‚ Ğ´Ğ»Ñ "${query}" Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ.`);
    }
});

// ĞĞĞ’ĞĞ¯ ĞšĞĞœĞĞĞ”Ğ: /fullmenu
bot.onText(/\/fullmenu/, (msg) => {
    const chatId = msg.chat.id;
    let response = "ğŸ—“ï¸ *ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ°Ğ½Ñ‡Ğ° Â«ĞšÑƒÑ…Ğ½Ğ¸ ĞœĞ¸Ñ€Ğ°Â»*\n\n";
    
    Object.keys(menuData).forEach(dayKey => {
        const dayData = menuData[dayKey];
        response += `\n*${dayNames[dayKey]} â€” ${dayData.name}*\n`;
        const buttons = [];
        dayData.dishes.forEach(dish => {
            response += `  ${dish.type === 'Ğ¡Ğ°Ğ»Ğ°Ñ‚' ? 'ğŸ¥—' : dish.type === 'Ğ¡ÑƒĞ¿' ? 'ğŸ²' : 'ğŸ¥˜'} *${dish.name}* ${dish.desc}\n`;
            buttons.push({ text: `ğŸ“œ Ğ ĞµÑ†ĞµĞ¿Ñ‚ "${dish.name}"`, callback_data: `recipe_${dish.id}` });
        });
        
        const keyboard = [];
        for (let i = 0; i < buttons.length; i += 1) {
            keyboard.push(buttons.slice(i, i + 1));
        }

        bot.sendMessage(chatId, response, {
            parse_mode: 'Markdown',
            reply_markup: {
                inline_keyboard: keyboard
            }
        });
        response = ""; // Reset for next day
    });
});

// ĞĞĞ’ĞĞ¯ Ğ›ĞĞ“Ğ˜ĞšĞ: Ğ ĞµĞ°ĞºÑ†Ğ¸Ñ Ğ½Ğ° ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°
bot.on('message', (msg) => {
    const chatId = msg.chat.id;
    const text = msg.text ? msg.text.toLowerCase() : '';

    // Ğ˜Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¸ ÑĞ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
    if (text.startsWith('/') || msg.from.is_bot) return;

    if (text.includes('ÑˆĞµÑ„') || text.includes('Ğ±Ğ¾Ñ‚') || text.includes('Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ')) {
        const helpMessage = `Ğ¡Ğ»ÑƒÑˆĞ°Ñ Ğ²Ğ°Ñ! ğŸ‘¨â€ğŸ³\n\nĞ•ÑĞ»Ğ¸ Ğ²Ğ°Ğ¼ Ğ½ÑƒĞ¶Ğ½Ğ° Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ, Ğ²Ğ¾ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚ĞµÑÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ¼Ğ¸:\n- **/menu [Ğ´ĞµĞ½ÑŒ]**\n- **/recipe [Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ]**\n- **/fullmenu**`;
        bot.sendMessage(chatId, helpMessage);
    }
});


// ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ¸Ğ¹ Ğ½Ğ° inline-ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
bot.on('callback_query', (callbackQuery) => {
    const msg = callbackQuery.message;
    const data = callbackQuery.data;
    const chatId = msg.chat.id;
    const user = callbackQuery.from.first_name;

    if (data.startsWith('recipe_')) {
        const dishId = data.replace('recipe_', '');
        let foundDish = null;
        for (const day in menuData) {
            const dish = menuData[day].dishes.find(d => d.id === dishId);
            if (dish) { foundDish = dish; break; }
        }
        if (foundDish) {
            const response = `*ĞšÑ€Ğ°Ñ‚ĞºĞ°Ñ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ "${foundDish.name}":*\n\n${foundDish.cooking_process}`;
            bot.sendMessage(chatId, response, { parse_mode: 'Markdown' });
            bot.answerCallbackQuery(callbackQuery.id, { text: `Ğ ĞµÑ†ĞµĞ¿Ñ‚ "${foundDish.name}" Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½.` });
        }
    } else if (data === 'line_check_confirm') {
        bot.editMessageText(`*Ğ£Ñ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğ¹ Ğ›Ğ°Ğ¹Ğ½-Ñ‡ĞµĞº (09:00)*\n\nĞ¡Ñ‚Ğ°Ğ½Ñ†Ğ¸Ñ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ° Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ. âœ…\n_ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ğ»(Ğ°): ${user} Ğ² ${new Date().toLocaleTimeString('ru-RU', { timeZone: 'Europe/Moscow' })}_`, {
            chat_id: chatId,
            message_id: msg.message_id,
            parse_mode: 'Markdown'
        });
        bot.answerCallbackQuery(callbackQuery.id, { text: `Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾, ${user}! Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½.` });
    }
});

// --- 5. ĞŸÑ€Ğ¾Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ (ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº) ---
cron.schedule('0 6 * * 1-5', () => {
    const message = `*Ğ£Ñ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğ¹ Ğ›Ğ°Ğ¹Ğ½-Ñ‡ĞµĞº (09:00)*\n\nĞ”Ğ¾Ğ±Ñ€Ğ¾Ğµ ÑƒÑ‚Ñ€Ğ¾, ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°! ĞŸĞ¾Ñ€Ğ° Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ğ¸. ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ.`;
    const options = {
        reply_markup: {
            inline_keyboard: [
                [{ text: 'âœ… ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ', callback_data: 'line_check_confirm' }]
            ]
        },
        parse_mode: 'Markdown'
    };
    bot.sendMessage(KITCHEN_CHAT_ID, message, options);
}, {
    timezone: "Etc/UTC"
});

cron.schedule('0 12 * * 1-5', () => {
    const message = `*ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ HACCP (15:00)*\n\nĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ: Ğ’Ñ€ĞµĞ¼Ñ Ğ·Ğ°Ğ¼ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞ¼Ğ¿ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ñƒ Ğ² Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ¸Ğ»ÑŒĞ½Ğ¸ĞºĞµ â„–2 (Ğ¼ÑÑĞ½Ğ¾Ğ¹). Ğ’Ğ½ĞµÑĞ¸Ñ‚Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ² Ğ¶ÑƒÑ€Ğ½Ğ°Ğ».`;
    bot.sendMessage(KITCHEN_CHAT_ID, message, { parse_mode: 'Markdown' });
}, {
    timezone: "Etc/UTC"
});

// --- 6. Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞµÑ€Ğ²ĞµÑ€Ğ° ---
const listener = app.listen(process.env.PORT || 3000, () => {
  console.log("Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ¸ ÑĞ»ÑƒÑˆĞ°ĞµÑ‚ Ğ¿Ğ¾Ñ€Ñ‚ " + listener.address().port);
});
